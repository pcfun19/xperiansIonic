/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, Renderer2, } from '@angular/core';
import { SW_SWIPE_CARD_DEFAULT_OPTIONS, SWSwipeCardConfig } from './swipe-card.config';
var SwipeableDirective = /** @class */ (function () {
    function SwipeableDirective(_defaultConfig, el, renderer) {
        this._defaultConfig = _defaultConfig;
        this.el = el;
        this.renderer = renderer;
        this.animationDuration = 200;
        this.isReleased = false;
        this.fixed = false;
        this.orientation = 'xy';
        this.released = new EventEmitter();
        this.swiped = new EventEmitter();
        this.className = true;
        this.element = el.nativeElement;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    SwipeableDirective.prototype.onPan = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.allowSwipe) {
            this.handleSwipeChange(event);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SwipeableDirective.prototype.onPanEnd = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.allowSwipe) {
            /** @type {?} */
            var conditionX = this.orientation.includes('x') && this.releaseRadius.x < Math.abs(event.deltaX || 0);
            /** @type {?} */
            var conditionY = this.orientation.includes('y') && this.releaseRadius.y < Math.abs(event.deltaY || 0);
            /** @type {?} */
            var like = this.isSwipePositive(event);
            (conditionX || conditionY) ? this.handleSwipeEnd(like) : this.handleCancelSwipe();
        }
    };
    Object.defineProperty(SwipeableDirective.prototype, "allowSwipe", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.fixed && !this.isReleased;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        window.clearTimeout(this.timeoutId);
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initializeOverlay();
        this.releaseRadius = { x: this.width / 4, y: this.height / 4 };
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.initializeOverlay = /**
     * @return {?}
     */
    function () {
        this.overlay = document.createElement('div');
        this.overlay.className = 'swipe-card-overlay';
        this.renderer.appendChild(this.element, this.overlay);
    };
    /**
     * @param {?} __0
     * @return {?}
     */
    SwipeableDirective.prototype.translate = /**
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var x = _a.x, y = _a.y, _b = _a.rotate, rotate = _b === void 0 ? 0 : _b, _c = _a.duration, duration = _c === void 0 ? 0 : _c;
        /** @type {?} */
        var positionX = x && this.orientation.includes('x') ? (x) : 0;
        /** @type {?} */
        var positionY = y && this.orientation.includes('y') ? (y) : 0;
        this.renderer.setStyle(this.element, 'transition', "transform " + duration + "ms ease");
        this.renderer.setStyle(this.element, 'webkitTransform', "translate3d(" + positionX + "px, " + positionY + "px, 0) rotate(" + rotate + "deg)");
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SwipeableDirective.prototype.handleSwipeChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var like = this.isSwipePositive(event);
        /** @type {?} */
        var opacity = Math.abs(event.distance) * 0.5 / this.element.offsetWidth;
        this.setBackgroundOverlay(like, opacity);
        this.translate({
            x: event.deltaX,
            y: event.deltaY,
            rotate: ((event.deltaX * 20) / this.element.clientWidth)
        });
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.handleCancelSwipe = /**
     * @return {?}
     */
    function () {
        this.resetBackgroundOverlay();
        this.translate({
            x: 0,
            y: 0,
            rotate: 0,
            duration: this.animationDuration
        });
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.resetElementStyles();
        this.resetBackgroundOverlay();
        this.renderer.removeChild(this.element, this.overlay);
        this.overlay = null;
    };
    /**
     * @param {?} like
     * @param {?} opacity
     * @return {?}
     */
    SwipeableDirective.prototype.setBackgroundOverlay = /**
     * @param {?} like
     * @param {?} opacity
     * @return {?}
     */
    function (like, opacity) {
        /** @type {?} */
        var color = like ? this._defaultConfig.likeColor : this._defaultConfig.dislikeColor;
        this.renderer.setStyle(this.overlay, 'transition', 'opacity 0s ease');
        this.renderer.setStyle(this.overlay, 'background-color', "rgba(" + color + ", " + opacity.toString() + ")");
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.resetBackgroundOverlay = /**
     * @return {?}
     */
    function () {
        this.renderer.setStyle(this.overlay, 'transition', "opacity " + this.animationDuration + "ms ease");
        this.renderer.setStyle(this.overlay, 'background-color', 'rgba(255,255,255,0)');
    };
    /**
     * @return {?}
     */
    SwipeableDirective.prototype.resetElementStyles = /**
     * @return {?}
     */
    function () {
        this.renderer.setStyle(this.element, 'transition', 'transform 0s ease');
        this.renderer.setStyle(this.element, 'webkitTransform', 'translate3d(0, 0, 0) rotate(0deg)');
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SwipeableDirective.prototype.isSwipePositive = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        return (this.orientation === 'y' && event.deltaY < 0) || (this.orientation !== 'y' && event.deltaX > 0);
    };
    /**
     * @param {?} like
     * @return {?}
     */
    SwipeableDirective.prototype.removeOverlay = /**
     * @param {?} like
     * @return {?}
     */
    function (like) {
        var _a = this.element, offsetHeight = _a.offsetHeight, offsetWidth = _a.offsetWidth, clientHeight = _a.clientHeight, clientWidth = _a.clientWidth;
        /** @type {?} */
        var y = (offsetHeight + clientHeight) * (like ? -1 : 1);
        /** @type {?} */
        var x = (offsetWidth + clientWidth) * (like ? 1 : -1);
        this.setBackgroundOverlay(like, 0.35);
        this.translate({
            x: x, y: y,
            rotate: (x * 20) / clientWidth,
            duration: 800
        });
    };
    /**
     * @param {?} like
     * @return {?}
     */
    SwipeableDirective.prototype.handleSwipeEnd = /**
     * @param {?} like
     * @return {?}
     */
    function (like) {
        var _this = this;
        this.removeOverlay(like);
        this.isReleased = true;
        this.timeoutId = window.setTimeout(function () {
            _this.swiped.emit(like);
            _this.released.emit();
            _this.destroy();
        }, this.animationDuration);
    };
    /**
     * @param {?} like
     * @return {?}
     */
    SwipeableDirective.prototype.simulateSwipe = /**
     * @param {?} like
     * @return {?}
     */
    function (like) {
        this.handleSwipeEnd(like);
    };
    SwipeableDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[swSwipeable]',
                },] },
    ];
    SwipeableDirective.ctorParameters = function () { return [
        { type: SWSwipeCardConfig, decorators: [{ type: Inject, args: [SW_SWIPE_CARD_DEFAULT_OPTIONS,] }] },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    SwipeableDirective.propDecorators = {
        width: [{ type: HostBinding, args: ['style.width.px',] }, { type: Input }],
        height: [{ type: HostBinding, args: ['style.height.px',] }, { type: Input }],
        fixed: [{ type: Input }],
        orientation: [{ type: Input }],
        released: [{ type: Output }],
        swiped: [{ type: Output }],
        className: [{ type: HostBinding, args: ['class.swipe-card-heap',] }],
        onPan: [{ type: HostListener, args: ['pan', ['$event'],] }],
        onPanEnd: [{ type: HostListener, args: ['panend', ['$event'],] }]
    };
    return SwipeableDirective;
}());
export { SwipeableDirective };
if (false) {
    /** @type {?} */
    SwipeableDirective.prototype.animationDuration;
    /** @type {?} */
    SwipeableDirective.prototype.isReleased;
    /** @type {?} */
    SwipeableDirective.prototype.element;
    /** @type {?} */
    SwipeableDirective.prototype.overlay;
    /** @type {?} */
    SwipeableDirective.prototype.releaseRadius;
    /** @type {?} */
    SwipeableDirective.prototype.timeoutId;
    /** @type {?} */
    SwipeableDirective.prototype.width;
    /** @type {?} */
    SwipeableDirective.prototype.height;
    /** @type {?} */
    SwipeableDirective.prototype.fixed;
    /** @type {?} */
    SwipeableDirective.prototype.orientation;
    /** @type {?} */
    SwipeableDirective.prototype.released;
    /** @type {?} */
    SwipeableDirective.prototype.swiped;
    /** @type {?} */
    SwipeableDirective.prototype.className;
    /** @type {?} */
    SwipeableDirective.prototype._defaultConfig;
    /** @type {?} */
    SwipeableDirective.prototype.el;
    /** @type {?} */
    SwipeableDirective.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGVhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXN3aXBlLWNhcmQvIiwic291cmNlcyI6WyJsaWIvc3dpcGVhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBQUUsU0FBUyxHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsNkJBQTZCLEVBQUUsaUJBQWlCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUVyRjtJQXdERSw0QkFBMkQsY0FBaUMsRUFDdEUsRUFBYyxFQUNqQixRQUFtQjtRQUZxQixtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFDdEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNqQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBdERyQixzQkFBaUIsR0FBRyxHQUFHLENBQUM7UUFDakMsZUFBVSxHQUFZLEtBQUssQ0FBQztRQWU3QixVQUFLLEdBQVksS0FBSyxDQUFDO1FBR3ZCLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBR25CLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRzlCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBR3JDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUEyQnRCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztJQUNsQyxDQUFDOzs7OztJQXpCRCxrQ0FBSzs7OztJQURMLFVBQ00sS0FBVTtRQUNkLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0gsQ0FBQzs7Ozs7SUFHRCxxQ0FBUTs7OztJQURSLFVBQ1MsS0FBVTtRQUNqQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQzs7Z0JBQ2QsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7O2dCQUNqRyxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQzs7Z0JBQ2pHLElBQUksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQztZQUV4QyxDQUFDLFVBQVUsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDcEYsQ0FBQztJQUNILENBQUM7SUFFRCxzQkFBSSwwQ0FBVTs7OztRQUFkO1lBQ0UsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDekMsQ0FBQzs7O09BQUE7Ozs7SUFRRCx3Q0FBVzs7O0lBQVg7UUFDRSxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs7O0lBRUQscUNBQVE7OztJQUFSO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUMsQ0FBQztJQUMvRCxDQUFDOzs7O0lBRU8sOENBQWlCOzs7SUFBekI7UUFDRSxJQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsb0JBQW9CLENBQUM7UUFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEQsQ0FBQzs7Ozs7SUFFTyxzQ0FBUzs7OztJQUFqQixVQUFrQixFQUFnQztZQUEvQixRQUFDLEVBQUUsUUFBQyxFQUFFLGNBQVUsRUFBViwrQkFBVSxFQUFFLGdCQUFZLEVBQVosaUNBQVk7O1lBQ3pDLFNBQVMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O1lBQ3pELFNBQVMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFL0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsZUFBYSxRQUFRLFlBQVMsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWUsU0FBUyxZQUFPLFNBQVMsc0JBQWlCLE1BQU0sU0FBTSxDQUM1SCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFTyw4Q0FBaUI7Ozs7SUFBekIsVUFBMEIsS0FBVTs7WUFDNUIsSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDOztZQUNsQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVztRQUV6RSxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDYixDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU07WUFDZixDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU07WUFDZixNQUFNLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7U0FDekQsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7OztJQUVPLDhDQUFpQjs7O0lBQXpCO1FBQ0UsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUNiLENBQUMsRUFBRSxDQUFDO1lBQ0osQ0FBQyxFQUFFLENBQUM7WUFDSixNQUFNLEVBQUUsQ0FBQztZQUNULFFBQVEsRUFBRSxJQUFJLENBQUMsaUJBQWlCO1NBQ2pDLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFTyxvQ0FBTzs7O0lBQWY7UUFDRSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztJQUN0QixDQUFDOzs7Ozs7SUFFTyxpREFBb0I7Ozs7O0lBQTVCLFVBQTZCLElBQWEsRUFBRSxPQUFlOztZQUNuRCxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZO1FBRXJGLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxVQUFRLEtBQUssVUFBSyxPQUFPLENBQUMsUUFBUSxFQUFFLE1BQUcsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7Ozs7SUFFTyxtREFBc0I7OztJQUE5QjtRQUNFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQVcsSUFBSSxDQUFDLGlCQUFpQixZQUFTLENBQUMsQ0FBQztRQUMvRixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixDQUFDLENBQUM7SUFDbEYsQ0FBQzs7OztJQUVPLCtDQUFrQjs7O0lBQTFCO1FBQ0UsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUN4RSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLG1DQUFtQyxDQUFDLENBQUM7SUFDL0YsQ0FBQzs7Ozs7SUFFTyw0Q0FBZTs7OztJQUF2QixVQUF3QixLQUFLO1FBQzNCLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzFHLENBQUM7Ozs7O0lBRU8sMENBQWE7Ozs7SUFBckIsVUFBc0IsSUFBYTtRQUMzQixJQUFBLGlCQUFxRSxFQUFwRSw4QkFBWSxFQUFFLDRCQUFXLEVBQUUsOEJBQVksRUFBRSw0QkFBVzs7WUFDckQsQ0FBQyxHQUFHLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztZQUNuRCxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdkQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ2IsQ0FBQyxHQUFBLEVBQUUsQ0FBQyxHQUFBO1lBQ0osTUFBTSxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLFdBQVc7WUFDOUIsUUFBUSxFQUFFLEdBQUc7U0FDZCxDQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVPLDJDQUFjOzs7O0lBQXRCLFVBQXVCLElBQWE7UUFBcEMsaUJBU0M7UUFSQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBRXZCLElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztZQUNqQyxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2QixLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3JCLEtBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQixDQUFDLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDN0IsQ0FBQzs7Ozs7SUFFTSwwQ0FBYTs7OztJQUFwQixVQUFxQixJQUFhO1FBQ2hDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUIsQ0FBQzs7Z0JBbEtGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsZUFBZTtpQkFDMUI7OztnQkFKc0MsaUJBQWlCLHVCQTBEekMsTUFBTSxTQUFDLDZCQUE2QjtnQkFwRWpELFVBQVU7Z0JBUUYsU0FBUzs7O3dCQWVoQixXQUFXLFNBQUMsZ0JBQWdCLGNBQzVCLEtBQUs7eUJBR0wsV0FBVyxTQUFDLGlCQUFpQixjQUM3QixLQUFLO3dCQUdMLEtBQUs7OEJBR0wsS0FBSzsyQkFHTCxNQUFNO3lCQUdOLE1BQU07NEJBR04sV0FBVyxTQUFDLHVCQUF1Qjt3QkFHbkMsWUFBWSxTQUFDLEtBQUssRUFBRSxDQUFDLFFBQVEsQ0FBQzsyQkFPOUIsWUFBWSxTQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7SUEwSHBDLHlCQUFDO0NBQUEsQUFuS0QsSUFtS0M7U0FoS1ksa0JBQWtCOzs7SUFDN0IsK0NBQXlDOztJQUN6Qyx3Q0FBb0M7O0lBQ3BDLHFDQUE2Qjs7SUFDN0IscUNBQTZCOztJQUM3QiwyQ0FBZ0Q7O0lBQ2hELHVDQUEwQjs7SUFFMUIsbUNBRXFCOztJQUVyQixvQ0FFc0I7O0lBRXRCLG1DQUM4Qjs7SUFFOUIseUNBQzBCOztJQUUxQixzQ0FDcUM7O0lBRXJDLG9DQUM0Qzs7SUFFNUMsdUNBQ3dCOztJQXdCWiw0Q0FBZ0Y7O0lBQ2hGLGdDQUF3Qjs7SUFDeEIsc0NBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsIFJlbmRlcmVyMixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1NXX1NXSVBFX0NBUkRfREVGQVVMVF9PUFRJT05TLCBTV1N3aXBlQ2FyZENvbmZpZ30gZnJvbSAnLi9zd2lwZS1jYXJkLmNvbmZpZyc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tzd1N3aXBlYWJsZV0nLFxufSlcbmV4cG9ydCBjbGFzcyBTd2lwZWFibGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgYW5pbWF0aW9uRHVyYXRpb24gPSAyMDA7XG4gIHByaXZhdGUgaXNSZWxlYXNlZDogQm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG92ZXJsYXk6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHJlbGVhc2VSYWRpdXM6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfTtcbiAgcHJpdmF0ZSB0aW1lb3V0SWQ6IG51bWJlcjtcblxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLndpZHRoLnB4JylcbiAgQElucHV0KClcbiAgcHVibGljIHdpZHRoOiBudW1iZXI7XG5cbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS5oZWlnaHQucHgnKVxuICBASW5wdXQoKVxuICBwdWJsaWMgaGVpZ2h0OiBudW1iZXI7XG5cbiAgQElucHV0KClcbiAgcHVibGljIGZpeGVkOiBCb29sZWFuID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgcHVibGljIG9yaWVudGF0aW9uID0gJ3h5JztcblxuICBAT3V0cHV0KClcbiAgcHVibGljIHJlbGVhc2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgc3dpcGVkID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3Muc3dpcGUtY2FyZC1oZWFwJylcbiAgcHVibGljIGNsYXNzTmFtZSA9IHRydWU7XG5cbiAgQEhvc3RMaXN0ZW5lcigncGFuJywgWyckZXZlbnQnXSlcbiAgb25QYW4oZXZlbnQ6IGFueSkge1xuICAgIGlmICh0aGlzLmFsbG93U3dpcGUpIHtcbiAgICAgIHRoaXMuaGFuZGxlU3dpcGVDaGFuZ2UoZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3BhbmVuZCcsIFsnJGV2ZW50J10pXG4gIG9uUGFuRW5kKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAodGhpcy5hbGxvd1N3aXBlKSB7XG4gICAgICBjb25zdCBjb25kaXRpb25YID0gdGhpcy5vcmllbnRhdGlvbi5pbmNsdWRlcygneCcpICYmIHRoaXMucmVsZWFzZVJhZGl1cy54IDwgTWF0aC5hYnMoZXZlbnQuZGVsdGFYIHx8IDApO1xuICAgICAgY29uc3QgY29uZGl0aW9uWSA9IHRoaXMub3JpZW50YXRpb24uaW5jbHVkZXMoJ3knKSAmJiB0aGlzLnJlbGVhc2VSYWRpdXMueSA8IE1hdGguYWJzKGV2ZW50LmRlbHRhWSB8fCAwKTtcbiAgICAgIGNvbnN0IGxpa2UgPSB0aGlzLmlzU3dpcGVQb3NpdGl2ZShldmVudCk7XG5cbiAgICAgIChjb25kaXRpb25YIHx8IGNvbmRpdGlvblkpID8gdGhpcy5oYW5kbGVTd2lwZUVuZChsaWtlKSA6IHRoaXMuaGFuZGxlQ2FuY2VsU3dpcGUoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgYWxsb3dTd2lwZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuZml4ZWQgJiYgIXRoaXMuaXNSZWxlYXNlZDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoU1dfU1dJUEVfQ0FSRF9ERUZBVUxUX09QVElPTlMpIHByaXZhdGUgX2RlZmF1bHRDb25maWc6IFNXU3dpcGVDYXJkQ29uZmlnLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgZWw6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgdGhpcy5lbGVtZW50ID0gZWwubmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SWQpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0aWFsaXplT3ZlcmxheSgpO1xuICAgIHRoaXMucmVsZWFzZVJhZGl1cyA9IHt4OiB0aGlzLndpZHRoIC8gNCwgeTogdGhpcy5oZWlnaHQgLyA0fTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU92ZXJsYXkoKTogdm9pZCB7XG4gICAgdGhpcy5vdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5vdmVybGF5LmNsYXNzTmFtZSA9ICdzd2lwZS1jYXJkLW92ZXJsYXknO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50LCB0aGlzLm92ZXJsYXkpO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc2xhdGUoe3gsIHksIHJvdGF0ZSA9IDAsIGR1cmF0aW9uID0gMH0pIHtcbiAgICBjb25zdCBwb3NpdGlvblggPSB4ICYmIHRoaXMub3JpZW50YXRpb24uaW5jbHVkZXMoJ3gnKSA/ICh4KSA6IDA7XG4gICAgY29uc3QgcG9zaXRpb25ZID0geSAmJiB0aGlzLm9yaWVudGF0aW9uLmluY2x1ZGVzKCd5JykgPyAoeSkgOiAwO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2l0aW9uJywgYHRyYW5zZm9ybSAke2R1cmF0aW9ufW1zIGVhc2VgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3dlYmtpdFRyYW5zZm9ybScsIGB0cmFuc2xhdGUzZCgke3Bvc2l0aW9uWH1weCwgJHtwb3NpdGlvbll9cHgsIDApIHJvdGF0ZSgke3JvdGF0ZX1kZWcpYFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVN3aXBlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCBsaWtlID0gdGhpcy5pc1N3aXBlUG9zaXRpdmUoZXZlbnQpO1xuICAgIGNvbnN0IG9wYWNpdHkgPSBNYXRoLmFicyhldmVudC5kaXN0YW5jZSkgKiAwLjUgLyB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cbiAgICB0aGlzLnNldEJhY2tncm91bmRPdmVybGF5KGxpa2UsIG9wYWNpdHkpO1xuICAgIHRoaXMudHJhbnNsYXRlKHtcbiAgICAgIHg6IGV2ZW50LmRlbHRhWCxcbiAgICAgIHk6IGV2ZW50LmRlbHRhWSxcbiAgICAgIHJvdGF0ZTogKChldmVudC5kZWx0YVggKiAyMCkgLyB0aGlzLmVsZW1lbnQuY2xpZW50V2lkdGgpXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUNhbmNlbFN3aXBlKCkge1xuICAgIHRoaXMucmVzZXRCYWNrZ3JvdW5kT3ZlcmxheSgpO1xuICAgIHRoaXMudHJhbnNsYXRlKHtcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgICAgcm90YXRlOiAwLFxuICAgICAgZHVyYXRpb246IHRoaXMuYW5pbWF0aW9uRHVyYXRpb25cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZGVzdHJveSgpIHtcbiAgICB0aGlzLnJlc2V0RWxlbWVudFN0eWxlcygpO1xuICAgIHRoaXMucmVzZXRCYWNrZ3JvdW5kT3ZlcmxheSgpO1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LCB0aGlzLm92ZXJsYXkpO1xuICAgIHRoaXMub3ZlcmxheSA9IG51bGw7XG4gIH1cblxuICBwcml2YXRlIHNldEJhY2tncm91bmRPdmVybGF5KGxpa2U6IGJvb2xlYW4sIG9wYWNpdHk6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbG9yID0gbGlrZSA/IHRoaXMuX2RlZmF1bHRDb25maWcubGlrZUNvbG9yIDogdGhpcy5fZGVmYXVsdENvbmZpZy5kaXNsaWtlQ29sb3I7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMub3ZlcmxheSwgJ3RyYW5zaXRpb24nLCAnb3BhY2l0eSAwcyBlYXNlJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLm92ZXJsYXksICdiYWNrZ3JvdW5kLWNvbG9yJywgYHJnYmEoJHtjb2xvcn0sICR7b3BhY2l0eS50b1N0cmluZygpfSlgKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRCYWNrZ3JvdW5kT3ZlcmxheSgpOiB2b2lkIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMub3ZlcmxheSwgJ3RyYW5zaXRpb24nLCBgb3BhY2l0eSAke3RoaXMuYW5pbWF0aW9uRHVyYXRpb259bXMgZWFzZWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5vdmVybGF5LCAnYmFja2dyb3VuZC1jb2xvcicsICdyZ2JhKDI1NSwyNTUsMjU1LDApJyk7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0RWxlbWVudFN0eWxlcygpOiB2b2lkIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3RyYW5zaXRpb24nLCAndHJhbnNmb3JtIDBzIGVhc2UnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3dlYmtpdFRyYW5zZm9ybScsICd0cmFuc2xhdGUzZCgwLCAwLCAwKSByb3RhdGUoMGRlZyknKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNTd2lwZVBvc2l0aXZlKGV2ZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLm9yaWVudGF0aW9uID09PSAneScgJiYgZXZlbnQuZGVsdGFZIDwgMCkgfHwgKHRoaXMub3JpZW50YXRpb24gIT09ICd5JyAmJiBldmVudC5kZWx0YVggPiAwKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlT3ZlcmxheShsaWtlOiBib29sZWFuKTogdm9pZCB7XG4gICAgY29uc3Qge29mZnNldEhlaWdodCwgb2Zmc2V0V2lkdGgsIGNsaWVudEhlaWdodCwgY2xpZW50V2lkdGh9ID0gdGhpcy5lbGVtZW50O1xuICAgIGNvbnN0IHkgPSAob2Zmc2V0SGVpZ2h0ICsgY2xpZW50SGVpZ2h0KSAqIChsaWtlID8gLTEgOiAxKTtcbiAgICBjb25zdCB4ID0gKG9mZnNldFdpZHRoICsgY2xpZW50V2lkdGgpICogKGxpa2UgPyAxIDogLTEpO1xuXG4gICAgdGhpcy5zZXRCYWNrZ3JvdW5kT3ZlcmxheShsaWtlLCAwLjM1KTtcbiAgICB0aGlzLnRyYW5zbGF0ZSh7XG4gICAgICB4LCB5LFxuICAgICAgcm90YXRlOiAoeCAqIDIwKSAvIGNsaWVudFdpZHRoLFxuICAgICAgZHVyYXRpb246IDgwMFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTd2lwZUVuZChsaWtlOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5yZW1vdmVPdmVybGF5KGxpa2UpO1xuICAgIHRoaXMuaXNSZWxlYXNlZCA9IHRydWU7XG5cbiAgICB0aGlzLnRpbWVvdXRJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuc3dpcGVkLmVtaXQobGlrZSk7XG4gICAgICB0aGlzLnJlbGVhc2VkLmVtaXQoKTtcbiAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgIH0sIHRoaXMuYW5pbWF0aW9uRHVyYXRpb24pO1xuICB9XG5cbiAgcHVibGljIHNpbXVsYXRlU3dpcGUobGlrZTogYm9vbGVhbikge1xuICAgIHRoaXMuaGFuZGxlU3dpcGVFbmQobGlrZSk7XG4gIH1cbn1cbiJdfQ==