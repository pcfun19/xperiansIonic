import { InjectionToken, Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, Renderer2, Component, ContentChildren, NgModule } from '@angular/core';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class SWSwipeCardConfig {
    constructor() {
        this.likeColor = '104,159,56';
        this.dislikeColor = '193,3,2';
    }
}
/** @type {?} */
const SW_SWIPE_CARD_DEFAULT_OPTIONS = new InjectionToken('sw-swipe-card-default-options', {
    providedIn: 'root',
    factory: SW_SWIPE_CARD_DEFAULT_OPTIONS_FACTORY
});
/**
 * @return {?}
 */
function SW_SWIPE_CARD_DEFAULT_OPTIONS_FACTORY() {
    return new SWSwipeCardConfig();
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class SwipeableDirective {
    /**
     * @param {?} _defaultConfig
     * @param {?} el
     * @param {?} renderer
     */
    constructor(_defaultConfig, el, renderer) {
        this._defaultConfig = _defaultConfig;
        this.el = el;
        this.renderer = renderer;
        this.animationDuration = 200;
        this.isReleased = false;
        this.fixed = false;
        this.orientation = 'xy';
        this.released = new EventEmitter();
        this.swiped = new EventEmitter();
        this.className = true;
        this.element = el.nativeElement;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPan(event) {
        if (this.allowSwipe) {
            this.handleSwipeChange(event);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPanEnd(event) {
        if (this.allowSwipe) {
            /** @type {?} */
            const conditionX = this.orientation.includes('x') && this.releaseRadius.x < Math.abs(event.deltaX || 0);
            /** @type {?} */
            const conditionY = this.orientation.includes('y') && this.releaseRadius.y < Math.abs(event.deltaY || 0);
            /** @type {?} */
            const like = this.isSwipePositive(event);
            (conditionX || conditionY) ? this.handleSwipeEnd(like) : this.handleCancelSwipe();
        }
    }
    /**
     * @return {?}
     */
    get allowSwipe() {
        return !this.fixed && !this.isReleased;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        window.clearTimeout(this.timeoutId);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initializeOverlay();
        this.releaseRadius = { x: this.width / 4, y: this.height / 4 };
    }
    /**
     * @return {?}
     */
    initializeOverlay() {
        this.overlay = document.createElement('div');
        this.overlay.className = 'swipe-card-overlay';
        this.renderer.appendChild(this.element, this.overlay);
    }
    /**
     * @param {?} __0
     * @return {?}
     */
    translate({ x, y, rotate = 0, duration = 0 }) {
        /** @type {?} */
        const positionX = x && this.orientation.includes('x') ? (x) : 0;
        /** @type {?} */
        const positionY = y && this.orientation.includes('y') ? (y) : 0;
        this.renderer.setStyle(this.element, 'transition', `transform ${duration}ms ease`);
        this.renderer.setStyle(this.element, 'webkitTransform', `translate3d(${positionX}px, ${positionY}px, 0) rotate(${rotate}deg)`);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleSwipeChange(event) {
        /** @type {?} */
        const like = this.isSwipePositive(event);
        /** @type {?} */
        const opacity = Math.abs(event.distance) * 0.5 / this.element.offsetWidth;
        this.setBackgroundOverlay(like, opacity);
        this.translate({
            x: event.deltaX,
            y: event.deltaY,
            rotate: ((event.deltaX * 20) / this.element.clientWidth)
        });
    }
    /**
     * @return {?}
     */
    handleCancelSwipe() {
        this.resetBackgroundOverlay();
        this.translate({
            x: 0,
            y: 0,
            rotate: 0,
            duration: this.animationDuration
        });
    }
    /**
     * @return {?}
     */
    destroy() {
        this.resetElementStyles();
        this.resetBackgroundOverlay();
        this.renderer.removeChild(this.element, this.overlay);
        this.overlay = null;
    }
    /**
     * @param {?} like
     * @param {?} opacity
     * @return {?}
     */
    setBackgroundOverlay(like, opacity) {
        /** @type {?} */
        const color = like ? this._defaultConfig.likeColor : this._defaultConfig.dislikeColor;
        this.renderer.setStyle(this.overlay, 'transition', 'opacity 0s ease');
        this.renderer.setStyle(this.overlay, 'background-color', `rgba(${color}, ${opacity.toString()})`);
    }
    /**
     * @return {?}
     */
    resetBackgroundOverlay() {
        this.renderer.setStyle(this.overlay, 'transition', `opacity ${this.animationDuration}ms ease`);
        this.renderer.setStyle(this.overlay, 'background-color', 'rgba(255,255,255,0)');
    }
    /**
     * @return {?}
     */
    resetElementStyles() {
        this.renderer.setStyle(this.element, 'transition', 'transform 0s ease');
        this.renderer.setStyle(this.element, 'webkitTransform', 'translate3d(0, 0, 0) rotate(0deg)');
    }
    /**
     * @param {?} event
     * @return {?}
     */
    isSwipePositive(event) {
        return (this.orientation === 'y' && event.deltaY < 0) || (this.orientation !== 'y' && event.deltaX > 0);
    }
    /**
     * @param {?} like
     * @return {?}
     */
    removeOverlay(like) {
        const { offsetHeight, offsetWidth, clientHeight, clientWidth } = this.element;
        /** @type {?} */
        const y = (offsetHeight + clientHeight) * (like ? -1 : 1);
        /** @type {?} */
        const x = (offsetWidth + clientWidth) * (like ? 1 : -1);
        this.setBackgroundOverlay(like, 0.35);
        this.translate({
            x, y,
            rotate: (x * 20) / clientWidth,
            duration: 800
        });
    }
    /**
     * @param {?} like
     * @return {?}
     */
    handleSwipeEnd(like) {
        this.removeOverlay(like);
        this.isReleased = true;
        this.timeoutId = window.setTimeout(() => {
            this.swiped.emit(like);
            this.released.emit();
            this.destroy();
        }, this.animationDuration);
    }
    /**
     * @param {?} like
     * @return {?}
     */
    simulateSwipe(like) {
        this.handleSwipeEnd(like);
    }
}
SwipeableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[swSwipeable]',
            },] },
];
SwipeableDirective.ctorParameters = () => [
    { type: SWSwipeCardConfig, decorators: [{ type: Inject, args: [SW_SWIPE_CARD_DEFAULT_OPTIONS,] }] },
    { type: ElementRef },
    { type: Renderer2 }
];
SwipeableDirective.propDecorators = {
    width: [{ type: HostBinding, args: ['style.width.px',] }, { type: Input }],
    height: [{ type: HostBinding, args: ['style.height.px',] }, { type: Input }],
    fixed: [{ type: Input }],
    orientation: [{ type: Input }],
    released: [{ type: Output }],
    swiped: [{ type: Output }],
    className: [{ type: HostBinding, args: ['class.swipe-card-heap',] }],
    onPan: [{ type: HostListener, args: ['pan', ['$event'],] }],
    onPanEnd: [{ type: HostListener, args: ['panend', ['$event'],] }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class CardWrapperComponent {
    constructor() {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
    }
    /**
     * @return {?}
     */
    like() {
        if (this.cards.first) {
            this.cards.first.simulateSwipe(true);
        }
    }
    /**
     * @return {?}
     */
    dislike() {
        if (this.cards.first) {
            this.cards.first.simulateSwipe(false);
        }
    }
}
CardWrapperComponent.decorators = [
    { type: Component, args: [{
                selector: 'sw-card-wrapper',
                template: `
    <ng-content></ng-content>`,
                styles: [`:host {
    position: relative;
    display: block;
  }`]
            },] },
];
CardWrapperComponent.ctorParameters = () => [];
CardWrapperComponent.propDecorators = {
    cards: [{ type: ContentChildren, args: [SwipeableDirective,] }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
class SwipeCardLibModule {
}
SwipeCardLibModule.decorators = [
    { type: NgModule, args: [{
                imports: [],
                declarations: [CardWrapperComponent, SwipeableDirective],
                exports: [CardWrapperComponent, SwipeableDirective]
            },] },
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */

export { SwipeCardLibModule, SWSwipeCardConfig, SW_SWIPE_CARD_DEFAULT_OPTIONS, SW_SWIPE_CARD_DEFAULT_OPTIONS_FACTORY, SwipeableDirective, CardWrapperComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc3dpcGUtY2FyZC5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vbmctc3dpcGUtY2FyZC9saWIvc3dpcGUtY2FyZC5jb25maWcudHMiLCJuZzovL25nLXN3aXBlLWNhcmQvbGliL3N3aXBlYWJsZS5kaXJlY3RpdmUudHMiLCJuZzovL25nLXN3aXBlLWNhcmQvbGliL2NhcmQtd3JhcHBlci5jb21wb25lbnQudHMiLCJuZzovL25nLXN3aXBlLWNhcmQvbGliL3N3aXBlLWNhcmQtbGliLm1vZHVsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGlvblRva2VufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGNsYXNzIFNXU3dpcGVDYXJkQ29uZmlnIHtcbiAgbGlrZUNvbG9yPzogc3RyaW5nID0gJzEwNCwxNTksNTYnO1xuICBkaXNsaWtlQ29sb3I/OiBzdHJpbmcgPSAnMTkzLDMsMic7XG59XG5cbmV4cG9ydCBjb25zdCBTV19TV0lQRV9DQVJEX0RFRkFVTFRfT1BUSU9OUyA9IG5ldyBJbmplY3Rpb25Ub2tlbignc3ctc3dpcGUtY2FyZC1kZWZhdWx0LW9wdGlvbnMnLCB7XG4gIHByb3ZpZGVkSW46ICdyb290JyxcbiAgZmFjdG9yeTogU1dfU1dJUEVfQ0FSRF9ERUZBVUxUX09QVElPTlNfRkFDVE9SWVxufSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBTV19TV0lQRV9DQVJEX0RFRkFVTFRfT1BUSU9OU19GQUNUT1JZKCkge1xuICByZXR1cm4gbmV3IFNXU3dpcGVDYXJkQ29uZmlnKCk7XG59XG4iLCJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCwgUmVuZGVyZXIyLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7U1dfU1dJUEVfQ0FSRF9ERUZBVUxUX09QVElPTlMsIFNXU3dpcGVDYXJkQ29uZmlnfSBmcm9tICcuL3N3aXBlLWNhcmQuY29uZmlnJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3N3U3dpcGVhYmxlXScsXG59KVxuZXhwb3J0IGNsYXNzIFN3aXBlYWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSByZWFkb25seSBhbmltYXRpb25EdXJhdGlvbiA9IDIwMDtcbiAgcHJpdmF0ZSBpc1JlbGVhc2VkOiBCb29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgb3ZlcmxheTogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgcmVsZWFzZVJhZGl1czogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9O1xuICBwcml2YXRlIHRpbWVvdXRJZDogbnVtYmVyO1xuXG4gIEBIb3N0QmluZGluZygnc3R5bGUud2lkdGgucHgnKVxuICBASW5wdXQoKVxuICBwdWJsaWMgd2lkdGg6IG51bWJlcjtcblxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLmhlaWdodC5weCcpXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBoZWlnaHQ6IG51bWJlcjtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgZml4ZWQ6IEJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgb3JpZW50YXRpb24gPSAneHknO1xuXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgcmVsZWFzZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBzd2lwZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zd2lwZS1jYXJkLWhlYXAnKVxuICBwdWJsaWMgY2xhc3NOYW1lID0gdHJ1ZTtcblxuICBASG9zdExpc3RlbmVyKCdwYW4nLCBbJyRldmVudCddKVxuICBvblBhbihldmVudDogYW55KSB7XG4gICAgaWYgKHRoaXMuYWxsb3dTd2lwZSkge1xuICAgICAgdGhpcy5oYW5kbGVTd2lwZUNoYW5nZShldmVudCk7XG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigncGFuZW5kJywgWyckZXZlbnQnXSlcbiAgb25QYW5FbmQoZXZlbnQ6IGFueSkge1xuICAgIGlmICh0aGlzLmFsbG93U3dpcGUpIHtcbiAgICAgIGNvbnN0IGNvbmRpdGlvblggPSB0aGlzLm9yaWVudGF0aW9uLmluY2x1ZGVzKCd4JykgJiYgdGhpcy5yZWxlYXNlUmFkaXVzLnggPCBNYXRoLmFicyhldmVudC5kZWx0YVggfHwgMCk7XG4gICAgICBjb25zdCBjb25kaXRpb25ZID0gdGhpcy5vcmllbnRhdGlvbi5pbmNsdWRlcygneScpICYmIHRoaXMucmVsZWFzZVJhZGl1cy55IDwgTWF0aC5hYnMoZXZlbnQuZGVsdGFZIHx8IDApO1xuICAgICAgY29uc3QgbGlrZSA9IHRoaXMuaXNTd2lwZVBvc2l0aXZlKGV2ZW50KTtcblxuICAgICAgKGNvbmRpdGlvblggfHwgY29uZGl0aW9uWSkgPyB0aGlzLmhhbmRsZVN3aXBlRW5kKGxpa2UpIDogdGhpcy5oYW5kbGVDYW5jZWxTd2lwZSgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBhbGxvd1N3aXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5maXhlZCAmJiAhdGhpcy5pc1JlbGVhc2VkO1xuICB9XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChTV19TV0lQRV9DQVJEX0RFRkFVTFRfT1BUSU9OUykgcHJpdmF0ZSBfZGVmYXVsdENvbmZpZzogU1dTd2lwZUNhcmRDb25maWcsXG4gICAgICAgICAgICAgIHByb3RlY3RlZCBlbDogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgcHVibGljIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXRJZCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmluaXRpYWxpemVPdmVybGF5KCk7XG4gICAgdGhpcy5yZWxlYXNlUmFkaXVzID0ge3g6IHRoaXMud2lkdGggLyA0LCB5OiB0aGlzLmhlaWdodCAvIDR9O1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplT3ZlcmxheSgpOiB2b2lkIHtcbiAgICB0aGlzLm92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLm92ZXJsYXkuY2xhc3NOYW1lID0gJ3N3aXBlLWNhcmQtb3ZlcmxheSc7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnQsIHRoaXMub3ZlcmxheSk7XG4gIH1cblxuICBwcml2YXRlIHRyYW5zbGF0ZSh7eCwgeSwgcm90YXRlID0gMCwgZHVyYXRpb24gPSAwfSkge1xuICAgIGNvbnN0IHBvc2l0aW9uWCA9IHggJiYgdGhpcy5vcmllbnRhdGlvbi5pbmNsdWRlcygneCcpID8gKHgpIDogMDtcbiAgICBjb25zdCBwb3NpdGlvblkgPSB5ICYmIHRoaXMub3JpZW50YXRpb24uaW5jbHVkZXMoJ3knKSA/ICh5KSA6IDA7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3RyYW5zaXRpb24nLCBgdHJhbnNmb3JtICR7ZHVyYXRpb259bXMgZWFzZWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnd2Via2l0VHJhbnNmb3JtJywgYHRyYW5zbGF0ZTNkKCR7cG9zaXRpb25YfXB4LCAke3Bvc2l0aW9uWX1weCwgMCkgcm90YXRlKCR7cm90YXRlfWRlZylgXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU3dpcGVDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGxpa2UgPSB0aGlzLmlzU3dpcGVQb3NpdGl2ZShldmVudCk7XG4gICAgY29uc3Qgb3BhY2l0eSA9IE1hdGguYWJzKGV2ZW50LmRpc3RhbmNlKSAqIDAuNSAvIHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIHRoaXMuc2V0QmFja2dyb3VuZE92ZXJsYXkobGlrZSwgb3BhY2l0eSk7XG4gICAgdGhpcy50cmFuc2xhdGUoe1xuICAgICAgeDogZXZlbnQuZGVsdGFYLFxuICAgICAgeTogZXZlbnQuZGVsdGFZLFxuICAgICAgcm90YXRlOiAoKGV2ZW50LmRlbHRhWCAqIDIwKSAvIHRoaXMuZWxlbWVudC5jbGllbnRXaWR0aClcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQ2FuY2VsU3dpcGUoKSB7XG4gICAgdGhpcy5yZXNldEJhY2tncm91bmRPdmVybGF5KCk7XG4gICAgdGhpcy50cmFuc2xhdGUoe1xuICAgICAgeDogMCxcbiAgICAgIHk6IDAsXG4gICAgICByb3RhdGU6IDAsXG4gICAgICBkdXJhdGlvbjogdGhpcy5hbmltYXRpb25EdXJhdGlvblxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXN0cm95KCkge1xuICAgIHRoaXMucmVzZXRFbGVtZW50U3R5bGVzKCk7XG4gICAgdGhpcy5yZXNldEJhY2tncm91bmRPdmVybGF5KCk7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQsIHRoaXMub3ZlcmxheSk7XG4gICAgdGhpcy5vdmVybGF5ID0gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QmFja2dyb3VuZE92ZXJsYXkobGlrZTogYm9vbGVhbiwgb3BhY2l0eTogbnVtYmVyKSB7XG4gICAgY29uc3QgY29sb3IgPSBsaWtlID8gdGhpcy5fZGVmYXVsdENvbmZpZy5saWtlQ29sb3IgOiB0aGlzLl9kZWZhdWx0Q29uZmlnLmRpc2xpa2VDb2xvcjtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5vdmVybGF5LCAndHJhbnNpdGlvbicsICdvcGFjaXR5IDBzIGVhc2UnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMub3ZlcmxheSwgJ2JhY2tncm91bmQtY29sb3InLCBgcmdiYSgke2NvbG9yfSwgJHtvcGFjaXR5LnRvU3RyaW5nKCl9KWApO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNldEJhY2tncm91bmRPdmVybGF5KCk6IHZvaWQge1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5vdmVybGF5LCAndHJhbnNpdGlvbicsIGBvcGFjaXR5ICR7dGhpcy5hbmltYXRpb25EdXJhdGlvbn1tcyBlYXNlYCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLm92ZXJsYXksICdiYWNrZ3JvdW5kLWNvbG9yJywgJ3JnYmEoMjU1LDI1NSwyNTUsMCknKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRFbGVtZW50U3R5bGVzKCk6IHZvaWQge1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAndHJhbnNpdGlvbicsICd0cmFuc2Zvcm0gMHMgZWFzZScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnd2Via2l0VHJhbnNmb3JtJywgJ3RyYW5zbGF0ZTNkKDAsIDAsIDApIHJvdGF0ZSgwZGVnKScpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1N3aXBlUG9zaXRpdmUoZXZlbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKHRoaXMub3JpZW50YXRpb24gPT09ICd5JyAmJiBldmVudC5kZWx0YVkgPCAwKSB8fCAodGhpcy5vcmllbnRhdGlvbiAhPT0gJ3knICYmIGV2ZW50LmRlbHRhWCA+IDApO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVPdmVybGF5KGxpa2U6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBjb25zdCB7b2Zmc2V0SGVpZ2h0LCBvZmZzZXRXaWR0aCwgY2xpZW50SGVpZ2h0LCBjbGllbnRXaWR0aH0gPSB0aGlzLmVsZW1lbnQ7XG4gICAgY29uc3QgeSA9IChvZmZzZXRIZWlnaHQgKyBjbGllbnRIZWlnaHQpICogKGxpa2UgPyAtMSA6IDEpO1xuICAgIGNvbnN0IHggPSAob2Zmc2V0V2lkdGggKyBjbGllbnRXaWR0aCkgKiAobGlrZSA/IDEgOiAtMSk7XG5cbiAgICB0aGlzLnNldEJhY2tncm91bmRPdmVybGF5KGxpa2UsIDAuMzUpO1xuICAgIHRoaXMudHJhbnNsYXRlKHtcbiAgICAgIHgsIHksXG4gICAgICByb3RhdGU6ICh4ICogMjApIC8gY2xpZW50V2lkdGgsXG4gICAgICBkdXJhdGlvbjogODAwXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVN3aXBlRW5kKGxpa2U6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnJlbW92ZU92ZXJsYXkobGlrZSk7XG4gICAgdGhpcy5pc1JlbGVhc2VkID0gdHJ1ZTtcblxuICAgIHRoaXMudGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5zd2lwZWQuZW1pdChsaWtlKTtcbiAgICAgIHRoaXMucmVsZWFzZWQuZW1pdCgpO1xuICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgfSwgdGhpcy5hbmltYXRpb25EdXJhdGlvbik7XG4gIH1cblxuICBwdWJsaWMgc2ltdWxhdGVTd2lwZShsaWtlOiBib29sZWFuKSB7XG4gICAgdGhpcy5oYW5kbGVTd2lwZUVuZChsaWtlKTtcbiAgfVxufVxuIiwiaW1wb3J0IHtBZnRlckNvbnRlbnRJbml0LCBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgT25Jbml0LCBRdWVyeUxpc3R9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTd2lwZWFibGVEaXJlY3RpdmV9IGZyb20gJy4vc3dpcGVhYmxlLmRpcmVjdGl2ZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3N3LWNhcmQtd3JhcHBlcicsXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PmAsXG4gIHN0eWxlczogW2A6aG9zdCB7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICB9YF1cbn0pXG5leHBvcnQgY2xhc3MgQ2FyZFdyYXBwZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQge1xuICBAQ29udGVudENoaWxkcmVuKFN3aXBlYWJsZURpcmVjdGl2ZSlcbiAgcHVibGljIGNhcmRzOiBRdWVyeUxpc3Q8U3dpcGVhYmxlRGlyZWN0aXZlPjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICB9XG5cbiAgcHVibGljIGxpa2UoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2FyZHMuZmlyc3QpIHtcbiAgICAgIHRoaXMuY2FyZHMuZmlyc3Quc2ltdWxhdGVTd2lwZSh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGlzbGlrZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jYXJkcy5maXJzdCkge1xuICAgICAgdGhpcy5jYXJkcy5maXJzdC5zaW11bGF0ZVN3aXBlKGZhbHNlKTtcbiAgICB9XG4gIH1cblxufVxuIiwiaW1wb3J0IHtOZ01vZHVsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NhcmRXcmFwcGVyQ29tcG9uZW50fSBmcm9tICcuL2NhcmQtd3JhcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHtTd2lwZWFibGVEaXJlY3RpdmV9IGZyb20gJy4vc3dpcGVhYmxlLmRpcmVjdGl2ZSc7XG5cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtdLFxuICBkZWNsYXJhdGlvbnM6IFtDYXJkV3JhcHBlckNvbXBvbmVudCwgU3dpcGVhYmxlRGlyZWN0aXZlXSxcbiAgZXhwb3J0czogW0NhcmRXcmFwcGVyQ29tcG9uZW50LCBTd2lwZWFibGVEaXJlY3RpdmVdXG59KVxuZXhwb3J0IGNsYXNzIFN3aXBlQ2FyZExpYk1vZHVsZSB7XG59XG4iXSwibmFtZXMi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