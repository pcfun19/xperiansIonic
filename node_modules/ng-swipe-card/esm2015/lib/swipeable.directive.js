/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, Renderer2, } from '@angular/core';
import { SW_SWIPE_CARD_DEFAULT_OPTIONS, SWSwipeCardConfig } from './swipe-card.config';
export class SwipeableDirective {
    /**
     * @param {?} _defaultConfig
     * @param {?} el
     * @param {?} renderer
     */
    constructor(_defaultConfig, el, renderer) {
        this._defaultConfig = _defaultConfig;
        this.el = el;
        this.renderer = renderer;
        this.animationDuration = 200;
        this.isReleased = false;
        this.fixed = false;
        this.orientation = 'xy';
        this.released = new EventEmitter();
        this.swiped = new EventEmitter();
        this.className = true;
        this.element = el.nativeElement;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPan(event) {
        if (this.allowSwipe) {
            this.handleSwipeChange(event);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onPanEnd(event) {
        if (this.allowSwipe) {
            /** @type {?} */
            const conditionX = this.orientation.includes('x') && this.releaseRadius.x < Math.abs(event.deltaX || 0);
            /** @type {?} */
            const conditionY = this.orientation.includes('y') && this.releaseRadius.y < Math.abs(event.deltaY || 0);
            /** @type {?} */
            const like = this.isSwipePositive(event);
            (conditionX || conditionY) ? this.handleSwipeEnd(like) : this.handleCancelSwipe();
        }
    }
    /**
     * @return {?}
     */
    get allowSwipe() {
        return !this.fixed && !this.isReleased;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        window.clearTimeout(this.timeoutId);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initializeOverlay();
        this.releaseRadius = { x: this.width / 4, y: this.height / 4 };
    }
    /**
     * @return {?}
     */
    initializeOverlay() {
        this.overlay = document.createElement('div');
        this.overlay.className = 'swipe-card-overlay';
        this.renderer.appendChild(this.element, this.overlay);
    }
    /**
     * @param {?} __0
     * @return {?}
     */
    translate({ x, y, rotate = 0, duration = 0 }) {
        /** @type {?} */
        const positionX = x && this.orientation.includes('x') ? (x) : 0;
        /** @type {?} */
        const positionY = y && this.orientation.includes('y') ? (y) : 0;
        this.renderer.setStyle(this.element, 'transition', `transform ${duration}ms ease`);
        this.renderer.setStyle(this.element, 'webkitTransform', `translate3d(${positionX}px, ${positionY}px, 0) rotate(${rotate}deg)`);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleSwipeChange(event) {
        /** @type {?} */
        const like = this.isSwipePositive(event);
        /** @type {?} */
        const opacity = Math.abs(event.distance) * 0.5 / this.element.offsetWidth;
        this.setBackgroundOverlay(like, opacity);
        this.translate({
            x: event.deltaX,
            y: event.deltaY,
            rotate: ((event.deltaX * 20) / this.element.clientWidth)
        });
    }
    /**
     * @return {?}
     */
    handleCancelSwipe() {
        this.resetBackgroundOverlay();
        this.translate({
            x: 0,
            y: 0,
            rotate: 0,
            duration: this.animationDuration
        });
    }
    /**
     * @return {?}
     */
    destroy() {
        this.resetElementStyles();
        this.resetBackgroundOverlay();
        this.renderer.removeChild(this.element, this.overlay);
        this.overlay = null;
    }
    /**
     * @param {?} like
     * @param {?} opacity
     * @return {?}
     */
    setBackgroundOverlay(like, opacity) {
        /** @type {?} */
        const color = like ? this._defaultConfig.likeColor : this._defaultConfig.dislikeColor;
        this.renderer.setStyle(this.overlay, 'transition', 'opacity 0s ease');
        this.renderer.setStyle(this.overlay, 'background-color', `rgba(${color}, ${opacity.toString()})`);
    }
    /**
     * @return {?}
     */
    resetBackgroundOverlay() {
        this.renderer.setStyle(this.overlay, 'transition', `opacity ${this.animationDuration}ms ease`);
        this.renderer.setStyle(this.overlay, 'background-color', 'rgba(255,255,255,0)');
    }
    /**
     * @return {?}
     */
    resetElementStyles() {
        this.renderer.setStyle(this.element, 'transition', 'transform 0s ease');
        this.renderer.setStyle(this.element, 'webkitTransform', 'translate3d(0, 0, 0) rotate(0deg)');
    }
    /**
     * @param {?} event
     * @return {?}
     */
    isSwipePositive(event) {
        return (this.orientation === 'y' && event.deltaY < 0) || (this.orientation !== 'y' && event.deltaX > 0);
    }
    /**
     * @param {?} like
     * @return {?}
     */
    removeOverlay(like) {
        const { offsetHeight, offsetWidth, clientHeight, clientWidth } = this.element;
        /** @type {?} */
        const y = (offsetHeight + clientHeight) * (like ? -1 : 1);
        /** @type {?} */
        const x = (offsetWidth + clientWidth) * (like ? 1 : -1);
        this.setBackgroundOverlay(like, 0.35);
        this.translate({
            x, y,
            rotate: (x * 20) / clientWidth,
            duration: 800
        });
    }
    /**
     * @param {?} like
     * @return {?}
     */
    handleSwipeEnd(like) {
        this.removeOverlay(like);
        this.isReleased = true;
        this.timeoutId = window.setTimeout(() => {
            this.swiped.emit(like);
            this.released.emit();
            this.destroy();
        }, this.animationDuration);
    }
    /**
     * @param {?} like
     * @return {?}
     */
    simulateSwipe(like) {
        this.handleSwipeEnd(like);
    }
}
SwipeableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[swSwipeable]',
            },] },
];
SwipeableDirective.ctorParameters = () => [
    { type: SWSwipeCardConfig, decorators: [{ type: Inject, args: [SW_SWIPE_CARD_DEFAULT_OPTIONS,] }] },
    { type: ElementRef },
    { type: Renderer2 }
];
SwipeableDirective.propDecorators = {
    width: [{ type: HostBinding, args: ['style.width.px',] }, { type: Input }],
    height: [{ type: HostBinding, args: ['style.height.px',] }, { type: Input }],
    fixed: [{ type: Input }],
    orientation: [{ type: Input }],
    released: [{ type: Output }],
    swiped: [{ type: Output }],
    className: [{ type: HostBinding, args: ['class.swipe-card-heap',] }],
    onPan: [{ type: HostListener, args: ['pan', ['$event'],] }],
    onPanEnd: [{ type: HostListener, args: ['panend', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    SwipeableDirective.prototype.animationDuration;
    /** @type {?} */
    SwipeableDirective.prototype.isReleased;
    /** @type {?} */
    SwipeableDirective.prototype.element;
    /** @type {?} */
    SwipeableDirective.prototype.overlay;
    /** @type {?} */
    SwipeableDirective.prototype.releaseRadius;
    /** @type {?} */
    SwipeableDirective.prototype.timeoutId;
    /** @type {?} */
    SwipeableDirective.prototype.width;
    /** @type {?} */
    SwipeableDirective.prototype.height;
    /** @type {?} */
    SwipeableDirective.prototype.fixed;
    /** @type {?} */
    SwipeableDirective.prototype.orientation;
    /** @type {?} */
    SwipeableDirective.prototype.released;
    /** @type {?} */
    SwipeableDirective.prototype.swiped;
    /** @type {?} */
    SwipeableDirective.prototype.className;
    /** @type {?} */
    SwipeableDirective.prototype._defaultConfig;
    /** @type {?} */
    SwipeableDirective.prototype.el;
    /** @type {?} */
    SwipeableDirective.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGVhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXN3aXBlLWNhcmQvIiwic291cmNlcyI6WyJsaWIvc3dpcGVhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBQUUsU0FBUyxHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsNkJBQTZCLEVBQUUsaUJBQWlCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUtyRixNQUFNOzs7Ozs7SUFxREosWUFBMkQsY0FBaUMsRUFDdEUsRUFBYyxFQUNqQixRQUFtQjtRQUZxQixtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFDdEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNqQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBdERyQixzQkFBaUIsR0FBRyxHQUFHLENBQUM7UUFDakMsZUFBVSxHQUFZLEtBQUssQ0FBQztRQWU3QixVQUFLLEdBQVksS0FBSyxDQUFDO1FBR3ZCLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBR25CLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRzlCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBR3JDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUEyQnRCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztJQUNsQyxDQUFDOzs7OztJQXpCRCxLQUFLLENBQUMsS0FBVTtRQUNkLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0gsQ0FBQzs7Ozs7SUFHRCxRQUFRLENBQUMsS0FBVTtRQUNqQixFQUFF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TTtxQkFHTixNQUFNO3dCQUdOLFdBQVcsU0FBQyx1QkFBdUI7b0JBR25DLFlBQVksU0FBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLENBQUM7dUJBTzlCLFlBQVksU0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUM7Ozs7SUFyQ2xDLCtDQUF5Qzs7SUFDekMsd0NBQW9DOztJQUNwQyxxQ0FBNkI7O0lBQzdCLHFDQUE2Qjs7SUFDN0IsMkNBQWdEOztJQUNoRCx1Q0FBMEI7O0lBRTFCLG1DQUVxQjs7SUFFckIsb0NBRXNCOztJQUV0QixtQ0FDOEI7O0lBRTlCLHlDQUMwQjs7SUFFMUIsc0NBQ3FDOztJQUVyQyxvQ0FDNEM7O0lBRTVDLHVDQUN3Qjs7SUF3QlosNENBQWdGOztJQUNoRixnQ0FBd0I7O0lBQ3hCLHNDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LCBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTV19TV0lQRV9DQVJEX0RFRkFVTFRfT1BUSU9OUywgU1dTd2lwZUNhcmRDb25maWd9IGZyb20gJy4vc3dpcGUtY2FyZC5jb25maWcnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbc3dTd2lwZWFibGVdJyxcbn0pXG5leHBvcnQgY2xhc3MgU3dpcGVhYmxlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGFuaW1hdGlvbkR1cmF0aW9uID0gMjAwO1xuICBwcml2YXRlIGlzUmVsZWFzZWQ6IEJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBlbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBvdmVybGF5OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSByZWxlYXNlUmFkaXVzOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIHByaXZhdGUgdGltZW91dElkOiBudW1iZXI7XG5cbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aC5weCcpXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyB3aWR0aDogbnVtYmVyO1xuXG4gIEBIb3N0QmluZGluZygnc3R5bGUuaGVpZ2h0LnB4JylcbiAgQElucHV0KClcbiAgcHVibGljIGhlaWdodDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBmaXhlZDogQm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBvcmllbnRhdGlvbiA9ICd4eSc7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyByZWxlYXNlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBAT3V0cHV0KClcbiAgcHVibGljIHN3aXBlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnN3aXBlLWNhcmQtaGVhcCcpXG4gIHB1YmxpYyBjbGFzc05hbWUgPSB0cnVlO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3BhbicsIFsnJGV2ZW50J10pXG4gIG9uUGFuKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAodGhpcy5hbGxvd1N3aXBlKSB7XG4gICAgICB0aGlzLmhhbmRsZVN3aXBlQ2hhbmdlKGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdwYW5lbmQnLCBbJyRldmVudCddKVxuICBvblBhbkVuZChldmVudDogYW55KSB7XG4gICAgaWYgKHRoaXMuYWxsb3dTd2lwZSkge1xuICAgICAgY29uc3QgY29uZGl0aW9uWCA9IHRoaXMub3JpZW50YXRpb24uaW5jbHVkZXMoJ3gnKSAmJiB0aGlzLnJlbGVhc2VSYWRpdXMueCA8IE1hdGguYWJzKGV2ZW50LmRlbHRhWCB8fCAwKTtcbiAgICAgIGNvbnN0IGNvbmRpdGlvblkgPSB0aGlzLm9yaWVudGF0aW9uLmluY2x1ZGVzKCd5JykgJiYgdGhpcy5yZWxlYXNlUmFkaXVzLnkgPCBNYXRoLmFicyhldmVudC5kZWx0YVkgfHwgMCk7XG4gICAgICBjb25zdCBsaWtlID0gdGhpcy5pc1N3aXBlUG9zaXRpdmUoZXZlbnQpO1xuXG4gICAgICAoY29uZGl0aW9uWCB8fCBjb25kaXRpb25ZKSA/IHRoaXMuaGFuZGxlU3dpcGVFbmQobGlrZSkgOiB0aGlzLmhhbmRsZUNhbmNlbFN3aXBlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGFsbG93U3dpcGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmZpeGVkICYmICF0aGlzLmlzUmVsZWFzZWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFNXX1NXSVBFX0NBUkRfREVGQVVMVF9PUFRJT05TKSBwcml2YXRlIF9kZWZhdWx0Q29uZmlnOiBTV1N3aXBlQ2FyZENvbmZpZyxcbiAgICAgICAgICAgICAgcHJvdGVjdGVkIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICBwdWJsaWMgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIHRoaXMuZWxlbWVudCA9IGVsLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdGlhbGl6ZU92ZXJsYXkoKTtcbiAgICB0aGlzLnJlbGVhc2VSYWRpdXMgPSB7eDogdGhpcy53aWR0aCAvIDQsIHk6IHRoaXMuaGVpZ2h0IC8gNH07XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVPdmVybGF5KCk6IHZvaWQge1xuICAgIHRoaXMub3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMub3ZlcmxheS5jbGFzc05hbWUgPSAnc3dpcGUtY2FyZC1vdmVybGF5JztcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCwgdGhpcy5vdmVybGF5KTtcbiAgfVxuXG4gIHByaXZhdGUgdHJhbnNsYXRlKHt4LCB5LCByb3RhdGUgPSAwLCBkdXJhdGlvbiA9IDB9KSB7XG4gICAgY29uc3QgcG9zaXRpb25YID0geCAmJiB0aGlzLm9yaWVudGF0aW9uLmluY2x1ZGVzKCd4JykgPyAoeCkgOiAwO1xuICAgIGNvbnN0IHBvc2l0aW9uWSA9IHkgJiYgdGhpcy5vcmllbnRhdGlvbi5pbmNsdWRlcygneScpID8gKHkpIDogMDtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAndHJhbnNpdGlvbicsIGB0cmFuc2Zvcm0gJHtkdXJhdGlvbn1tcyBlYXNlYCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd3ZWJraXRUcmFuc2Zvcm0nLCBgdHJhbnNsYXRlM2QoJHtwb3NpdGlvblh9cHgsICR7cG9zaXRpb25ZfXB4LCAwKSByb3RhdGUoJHtyb3RhdGV9ZGVnKWBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVTd2lwZUNoYW5nZShldmVudDogYW55KSB7XG4gICAgY29uc3QgbGlrZSA9IHRoaXMuaXNTd2lwZVBvc2l0aXZlKGV2ZW50KTtcbiAgICBjb25zdCBvcGFjaXR5ID0gTWF0aC5hYnMoZXZlbnQuZGlzdGFuY2UpICogMC41IC8gdGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgdGhpcy5zZXRCYWNrZ3JvdW5kT3ZlcmxheShsaWtlLCBvcGFjaXR5KTtcbiAgICB0aGlzLnRyYW5zbGF0ZSh7XG4gICAgICB4OiBldmVudC5kZWx0YVgsXG4gICAgICB5OiBldmVudC5kZWx0YVksXG4gICAgICByb3RhdGU6ICgoZXZlbnQuZGVsdGFYICogMjApIC8gdGhpcy5lbGVtZW50LmNsaWVudFdpZHRoKVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVDYW5jZWxTd2lwZSgpIHtcbiAgICB0aGlzLnJlc2V0QmFja2dyb3VuZE92ZXJsYXkoKTtcbiAgICB0aGlzLnRyYW5zbGF0ZSh7XG4gICAgICB4OiAwLFxuICAgICAgeTogMCxcbiAgICAgIHJvdGF0ZTogMCxcbiAgICAgIGR1cmF0aW9uOiB0aGlzLmFuaW1hdGlvbkR1cmF0aW9uXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZXNldEVsZW1lbnRTdHlsZXMoKTtcbiAgICB0aGlzLnJlc2V0QmFja2dyb3VuZE92ZXJsYXkoKTtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCwgdGhpcy5vdmVybGF5KTtcbiAgICB0aGlzLm92ZXJsYXkgPSBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRCYWNrZ3JvdW5kT3ZlcmxheShsaWtlOiBib29sZWFuLCBvcGFjaXR5OiBudW1iZXIpIHtcbiAgICBjb25zdCBjb2xvciA9IGxpa2UgPyB0aGlzLl9kZWZhdWx0Q29uZmlnLmxpa2VDb2xvciA6IHRoaXMuX2RlZmF1bHRDb25maWcuZGlzbGlrZUNvbG9yO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLm92ZXJsYXksICd0cmFuc2l0aW9uJywgJ29wYWNpdHkgMHMgZWFzZScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5vdmVybGF5LCAnYmFja2dyb3VuZC1jb2xvcicsIGByZ2JhKCR7Y29sb3J9LCAke29wYWNpdHkudG9TdHJpbmcoKX0pYCk7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0QmFja2dyb3VuZE92ZXJsYXkoKTogdm9pZCB7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLm92ZXJsYXksICd0cmFuc2l0aW9uJywgYG9wYWNpdHkgJHt0aGlzLmFuaW1hdGlvbkR1cmF0aW9ufW1zIGVhc2VgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMub3ZlcmxheSwgJ2JhY2tncm91bmQtY29sb3InLCAncmdiYSgyNTUsMjU1LDI1NSwwKScpO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNldEVsZW1lbnRTdHlsZXMoKTogdm9pZCB7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2l0aW9uJywgJ3RyYW5zZm9ybSAwcyBlYXNlJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd3ZWJraXRUcmFuc2Zvcm0nLCAndHJhbnNsYXRlM2QoMCwgMCwgMCkgcm90YXRlKDBkZWcpJyk7XG4gIH1cblxuICBwcml2YXRlIGlzU3dpcGVQb3NpdGl2ZShldmVudCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAodGhpcy5vcmllbnRhdGlvbiA9PT0gJ3knICYmIGV2ZW50LmRlbHRhWSA8IDApIHx8ICh0aGlzLm9yaWVudGF0aW9uICE9PSAneScgJiYgZXZlbnQuZGVsdGFYID4gMCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZU92ZXJsYXkobGlrZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGNvbnN0IHtvZmZzZXRIZWlnaHQsIG9mZnNldFdpZHRoLCBjbGllbnRIZWlnaHQsIGNsaWVudFdpZHRofSA9IHRoaXMuZWxlbWVudDtcbiAgICBjb25zdCB5ID0gKG9mZnNldEhlaWdodCArIGNsaWVudEhlaWdodCkgKiAobGlrZSA/IC0xIDogMSk7XG4gICAgY29uc3QgeCA9IChvZmZzZXRXaWR0aCArIGNsaWVudFdpZHRoKSAqIChsaWtlID8gMSA6IC0xKTtcblxuICAgIHRoaXMuc2V0QmFja2dyb3VuZE92ZXJsYXkobGlrZSwgMC4zNSk7XG4gICAgdGhpcy50cmFuc2xhdGUoe1xuICAgICAgeCwgeSxcbiAgICAgIHJvdGF0ZTogKHggKiAyMCkgLyBjbGllbnRXaWR0aCxcbiAgICAgIGR1cmF0aW9uOiA4MDBcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU3dpcGVFbmQobGlrZTogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMucmVtb3ZlT3ZlcmxheShsaWtlKTtcbiAgICB0aGlzLmlzUmVsZWFzZWQgPSB0cnVlO1xuXG4gICAgdGhpcy50aW1lb3V0SWQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnN3aXBlZC5lbWl0KGxpa2UpO1xuICAgICAgdGhpcy5yZWxlYXNlZC5lbWl0KCk7XG4gICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB9LCB0aGlzLmFuaW1hdGlvbkR1cmF0aW9uKTtcbiAgfVxuXG4gIHB1YmxpYyBzaW11bGF0ZVN3aXBlKGxpa2U6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmhhbmRsZVN3aXBlRW5kKGxpa2UpO1xuICB9XG59XG4iXX0=